{% with id=widget.attrs.id %}

    <ul class="mptt_tree"
        {% if id %}
          id="{{ id }}"
        {% endif %}
        {% if widget.attrs.class %}
          class="{{ widget.attrs.class }}"
        {% endif %}>
        {% for group, options, index in widget.optgroups %}
          {% if group %}
            <li>{{ group }}
              <ul
                      {% if id %}
                        id="{{ id }}_{{ index }}"
                      {% endif %}
              >

          {% endif %}
          {% for option in options %}
            <li {% if option.has_children %}class="has-children"{% endif %}>{% include option.template_name with widget=option %}
            </li>
          {% if option.has_children %}
              <ul class="has-children nested">
          {% elif option.tags_to_close %}
              {% for tag in option.tags_to_close %}
                  </ul>
              {% endfor %}
           {% endif %}
          {% endfor %}
          {% if group %}
            </ul></li>
          {% endif %}
        {% endfor %}
 </ul>
{% endwith %}
